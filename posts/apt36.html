<!doctype html>
<!--
'ello;

````````````````````````````````````````````````````````````````
````````````````````````````:'+##+',````````````````````````````
````````````````````````:##############.````````````````####````
``````````````````````+##################:````````````,#####+```
````````````````````'######################,``````````#######```
```````````````````##+';:::;'+###############````````########```
``````````````````.``` ,'+@###################``````.#######+```
````````````````````+##########################`````+####+.`````
`````````````````,##############################````####````````
````````````````#################################`:'###`````````
``````````````:#######################################:``.,`````
`````````````'#########################################,#####```
````````````,################################################'``
````````````#################################################;``
```````````.###################@########################   ,'```
```````````##############;.``````````,'################,````````
```````````###########.``````````````````;#############`````````
``````````.########+```````````````````````.##########``````````
``````````'#######```````````````````````````:#######.``````````
``````````######+``````````````````````````````######:``````````
``````````######```````````````````````````````.#####'``````````
``````````#####`````````````````````````````````######``````````
``````````####'````++':````````````````` ,'+#.```#####``````````
``````````####.``````;###'````````````:###+``````#####``````````
``````````####```````######:`````````#####+``````'####``````````
``````````####``````#########``````:########`````;####``````````
``````````####`````,########:#````'#########`````;####``````````
``````````#### `````########````````########`````'####``````````
``````````####.``````+####'``````````+####'``````#####``````````
``````````####+````````  `````````````` ````````.#####``````````
``````````#####`````````````````````````````````######``````````
``````````######```````````````````````````````;######``````````
``````````#######`````````````````````````````,#######``````````
``````````########``````````'######.`````````+########``````````
``````````##########,````.###########:`````+##########``````````
``````````,##########################################+``````````
```````````##########################################.``````````
```````````##########################################```````````
````````````########################################.```````````
````````````+#######################################````````````
`````````````######################################`````````````
`````````````,####################################;`````````````
``````````````+###################################``````````````
``````````:````##################################```````````````
``````````#.````################################`````@``````````
``````````##`````##############################`````##``````````
``````````###`````###########################+`````###``````````
``````````####.````#########################.`````####``````````
``````````#####;````:#####################;`````'#####``````````
``````````#######`````##################:``````######'``````````
``````````,#######.`````:+##########+:``````.########```````````
```````````;########``````````````````````;#########````````````
`````````````+########`````,+;,.````.,;##########+,`````````````
```````````````,+#######,`````.'#############+;.````````````````
```````````````````,;#####+, ````` `.,,,,.``````````````````````
```````````````````````` `..,,.`````````````````````````````````
````````````````````````````````````````````````````````````````
-->
<html>
<head>
<meta name="Description" content="Publications by ret2eax, a security researcher, consultant and enthusiast.">
<link rel="stylesheet" href="../Resources/css/hack.css">
<link rel="stylesheet" href="../Resources/css/themes/dark.css">
<title>0x01c: Reversing APT36 Malware Targeting Military & Diplomatic Resources</title>
</head>
<p>
<center><img src="../images/ret_logo.png" width="80"></center><br>
<center>((((λf.(λx.(fx)))(λy.y))(λz.z)))</center>
<p>
<center><< <a href="../index.html">home</a> >></center>
<body class="hack dark">
  <div class="main container">
<h1>0x01c: Reversing APT36 Malware Targeting Military & Diplomatic Resources</h1>
<pre class="hack dark">  _   _     ____
 |'| |'| U /"___|
/| |_| |\\| | u
U|  _  |u | |/__
 |_| |_|   \____|
 //   \\  _// \\
(_") ("_)(__)(__)


#homecrew
@ret2eax

ret2eax@h0m3cr3w:~$ ./content.sh

listing content..

[1.] INTRODUCTION
[2.] PAKISTAN AND INDIA POLITICAL RELATIONS AND TENSIONS
[3.] SIGNALS & IOCs
[4.] ANALYSIS OF SAMPLE X
[5.] ANALYSIS OF SAMPLE Y
[6.] YARRA RULE TO IDENTIFY FUTURE VARIANTS BASED ON SIMILARITIES WITHIN SAMPLE SET
[7.] CONCLUSION

___________________________________________________________________</pre>

<p>#[INTRODUCTION] :</p>

<p>APT36, also referred to as Operation C-Major, PROJECTM, Mythic Leopard, and Transparent Tribe, is a Pakistani government-aligned actor that is a politically motivated Advanced Persistent Threat (APT) group. This APT group has been linked to Pakistan and mainly focuses its resources on targeting Indian Government entities and personnel. The motivation behind these attacks is information theft and espionage to gather intelligence from the Indian government, military, and diplomatic resources.</p>
    
<p>An example of this was unveiled by an investigation in previous years, of which, identified the APT group targeting Windows systems across Indian embassies in Saudi Arabia and Kazakstan. Similarly, the group also targeted officials of India’s Central Bureau of Investigation  (CBI) agency. It was also discovered by CNN-IBN (an Indian TV station) that Pakistani officials were collecting data about Indian troop movements using an Android mobile app called SmeshApp. These Android campaigns continue to be prominent and I have identified over 70 variants of this malware used for the group’s campaigns targeting officials across the Android mobile ecosystem.</p>
    
<p>Typically, the APT group’s arrival methods include the use of spear-phishing and a USB worm that would then drop and execute a remote access trojan (RAT).  The group also uses Android RATs (mobile malware), as mentioned above, that could be deployed by such spear-phishing campaigns, alongside other deployment vectors. A notable campaign by this APT group was leveraging deceit through disguising a RAT via a fraudulent national COVID-19 contact tracing application.</p>
    
<p>The two malware strains that will be focused on here is in pertinence to such Android RATs weaponised to execute various payloads that would essentially spawn a remote backdoor on the targeted Android mobile device. These backdoors deployed by APT36 permit the group’s ability to intercept phone calls, SMS messages, track victims’ locations, and steal personal identifiable information (PII) amongst other capabilities.</p>

<p>#[PAKISTAN AND INDIA POLITICAL RELATIONS AND TENSIONS] :</p>

Go into details here.

  
<p>#[SIGNALS & IOCs] :</p>

<p>Malware analysis across the various samples shows that many of the campaigns and attacks appear related by common signals and IoCs (Indicators of Compromise). These signals and IoCs include, but are not limited to;</p>
    <p>.. more here ..</p> 

<p>#[ANALYSIS OF SAMPLE X] :</p>

    <p>The following analysis is based on a Android APK malware sample origintating from APT36. This sample has been defined here as sample X, and will be referred to as sample X from this point onwards. During the initial analysis it was identified that this sample had excessive android.permission.* constants defined within the application's manfiest. This permitted the application to leverage access to the relevant Android device functions associated with such constants. In addition to the aforementioned, the manifest details the sample's entry point alongside registered broadcast recievers. These definitions have been outlined within the sample's manifest below:</p>
<pre class="hack dark"><i>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; android:versionCode=&quot;1&quot; android:versionName=&quot;1.0&quot; package=&quot;com.example.redacted.redacted&quot; platformBuildVersionCode=&quot;23&quot; platformBuildVersionName=&quot;6.0-2438415&quot;&gt;
  &lt;uses-sdk android:minSdkVersion=&quot;13&quot; android:targetSdkVersion=&quot;21&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.ACCESS_NETWORK_STATE&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.ACCESS_WIFI_STATE&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.ACCESS_COARSE_LOCATION&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.RECEIVE_BOOT_COMPLETED&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.CHANGE_WIFI_MULTICAST_STATE&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.INTERNET&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.ACCESS_FINE_LOCATION&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.RECEIVE_SMS&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.READ_SMS&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.SEND_SMS&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.READ_PHONE_STATE&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.PROCESS_OUTGOING_CALLS&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.RECORD_AUDIO&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.CAMERA&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.CALL_PHONE&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.READ_CONTACTS&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.VIBRATE&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.READ_CALL_LOG&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.CLEAR_APP_CACHE&quot;/&gt;
  &lt;uses-permission android:name=&quot;android.permission.READ_INSTALL_SESSIONS&quot;/&gt;
  &lt;application android:theme=&quot;@style/AppTheme&quot; android:label=&quot;@string/app_name&quot; android:icon=&quot;@drawable/ic_launcher&quot; android:debuggable=&quot;true&quot; android:allowBackup=&quot;false&quot;&gt;
    &lt;activity android:label=&quot;@string/app_name&quot; android:name=&quot;com.example.appcode.appcode.MainActivity&quot;&gt;
      &lt;intent-filter&gt;
        &lt;action android:name=&quot;android.intent.action.MAIN&quot;/&gt;
        &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot;/&gt;
      &lt;/intent-filter&gt;
    &lt;/activity&gt;
    &lt;service android:name=&quot;com.example.appcode.appcode.CMDService&quot;&gt;
      &lt;action android:name=&quot;.CMDService&quot;/&gt;
    &lt;/service&gt;
    &lt;receiver android:name=&quot;com.example.appcode.appcode.BootUpReceiver&quot;&gt;
      &lt;intent-filter&gt;
        &lt;action android:name=&quot;android.intent.action.BOOT_COMPLETED&quot;/&gt;
        &lt;category android:name=&quot;android.intent.category.DEFAULT&quot;/&gt;
      &lt;/intent-filter&gt;
    &lt;/receiver&gt;
    &lt;receiver android:name=&quot;com.example.appcode.appcode.SMSMonitor&quot; android:exported=&quot;true&quot;&gt;
      &lt;intent-filter android:priority=&quot;999&quot;&gt;
        &lt;action android:name=&quot;android.provider.Telephony.SMS_RECEIVED&quot;/&gt;
      &lt;/intent-filter&gt;
    &lt;/receiver&gt;
    &lt;receiver android:name=&quot;com.example.appcode.appcode.CallMonitor&quot;&gt;
      &lt;intent-filter&gt;
        &lt;action android:name=&quot;android.intent.action.PHONE_STATE&quot;/&gt;
      &lt;/intent-filter&gt;
    &lt;/receiver&gt;
  &lt;/application&gt;
&lt;/manifest&gt;
</i>
</pre>

    <p>The above defnies the following Android device permissions:</p>
    
    <p>The above defines the sample's entry point via the android.intent.action.MAIN Android Intent:</p>
    
    <p>The above defines the registered broadcast recievers to be used for malicious intent:</p>
    
    <p>After decompiling the sample's DEX/SMALI to readable JAVA/Kotlin classes, the entry point, being, `MainActivity.class` defined by Android's "MAIN" intent contains and onCreate() method invoking the `CMDService.class`, of which is also invoked via the `onResume()` and `onStart()` method within the defined `MainActivity`. This is illustrated below:
      
          <pre class="hack dark"><i>
MainActivity.class CODE SNIPIT HERE
</i>
</pre>
      
      Following the callback to `CMDService.class`, we can see the sample defines command and control (C2) capabilities as well as instantiates programmatic `IF/ELSE` conditional statements for C2 flow prior to data exfiltration to the remote C2 server. This highlighted below:</p>

    <pre class="hack dark"><i>
CMDService.class CODE SNIPIT HERE
</i>
</pre>
    
    <p>In addition to the above, the sample contains a `CallMonitor`class and a `SMSMonitor` class, of which, both defines `HTTPAsyncTasks` that points to another class titled `setting`. This `setting.class` defines the remote C2 within the `webUrl` parameter for data exfiltration. The remote C2 is: `http[:]//android.viral91.xyz/admin/webservices` and can be seen within the below snipit:</p>
    
    <pre class="hack dark"><i>
CODE SNIPIT HERE
</i>
</pre>
    <p>blah</p>
     <pre class="hack dark"><i>
CODE SNIPIT HERE
</i>
</pre>
    <p>blah</p>
     <pre class="hack dark"><i>
CODE SNIPIT HERE
</i>
</pre>
    <p>blah</p>
     <pre class="hack dark"><i>
CODE SNIPIT HERE
</i>
</pre>
    <p>blah</p>
<p>#[ANALYSIS OF SAMPLE Y] :</p>

    <p>blah</p>
<pre class="hack dark"><i>
CODE SNIPIT HERE
</i>
</pre>

    <p>blah</p>

    <pre class="hack dark"><i>
CODE SNIPIT HERE
</i>
</pre>
    
    <p>blah</p>
    
    <pre class="hack dark"><i>
CODE SNIPIT HERE
</i>
</pre>
    <p>blah</p>
     <pre class="hack dark"><i>
CODE SNIPIT HERE
</i>
</pre>
    <p>blah</p>
     <pre class="hack dark"><i>
CODE SNIPIT HERE
</i>
</pre>
    <p>blah</p>
     <pre class="hack dark"><i>
CODE SNIPIT HERE
</i>
</pre>
    <p>blah</p>
    
    <p>#[YARRA RULE TO IDENTIFY FUTURE VARIANTS BASED ON SIMILARITIES WITHIN SAMPLE SET] :</p>
    <p>blah</p>
      <p>blah</p>
<pre class="hack dark"><i>
CODE SNIPIT HERE
</i>
<p>blah</p>
      <p>#[CONCLUSION] :</p>
    <p>blah</p>
<p> ~ ret2eax
</div>
<center>
<footer><< <a href=mailto:ret2eax@riseup.net>ret2eax@riseup.net</a> >></footer></center>
<p>
</body>
</html>


<!-- Goodbye -->
